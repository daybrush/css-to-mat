/*
Copyright (c) 2019 Daybrush
name: css-to-mat
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/css-to-mat.git
version: 1.0.0
*/
!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(r=r||self).CssToMatrix=t()}(this,function(){"use strict";var l=['"',"'",'\\"',"\\'"];function c(r,t,e,n){for(var a=e;a<n;++a){var i=t[a].trim();if(i===r)return a;var o=a;if("("===i?o=c(")",t,a+1,n):-1<l.indexOf(i)&&(o=c(i,t,a+1,n)),-1===o)break;a=o}return-1}function t(r,t){for(var e=new RegExp("(\\s*"+(t||",")+"\\s*|\\(|\\)|\"|'|\\\\\"|\\\\'|\\s+)","g"),n=r.split(e).filter(Boolean),a=n.length,i=[],o=[],u=0;u<a;++u){var f=n[u].trim(),s=u;if("("===f)s=c(")",n,u+1,a);else{if(")"===f)throw new Error("invalid format");if(-1<l.indexOf(f))s=c(f,n,u+1,a);else if(f===t){o.length&&(i.push(o.join("")),o=[]);continue}}-1===s&&(s=a-1),o.push(n.slice(u,s+1).join("")),u=s}return o.length&&i.push(o.join("")),i}function F(r){return t(r,",")}function s(r,t,e,n,a,i){for(var o=0;o<a;++o){var u=e+o*a,f=n+o*a;r[u]+=r[f]*i,t[u]+=t[f]*i}}function v(r,t,e,n,a){for(var i=0;i<a;++i){var o=e+i*a,u=n+i*a,f=r[o],s=t[o];r[o]=r[u],r[u]=f,t[o]=t[u],t[u]=s}}function d(r,t,e,n,a){for(var i=0;i<n;++i){var o=e+i*n;r[o]/=a,t[o]/=a}}function u(r,t,e){void 0===e&&(e=Math.sqrt(r.length));var n=[],a=r.length/e,i=t.length/a;if(!a)return t;if(!i)return r;for(var o=0;o<e;++o)for(var u=0;u<i;++u)for(var f=n[u*e+o]=0;f<a;++f)n[u*e+o]+=r[f*e+o]*t[u*a+f];return n}function y(r,t){return u(r,[1,0,0,0,0,Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1],4)}function E(r,t){return u(r,[Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1],4)}function b(r,t){return u(r,function(r,t){var e=Math.cos(r),n=Math.sin(r),a=p(t);return a[0]=e,a[1]=n,a[t]=-n,a[t+1]=e,a}(t,4))}function S(r,t){var e=t[0],n=void 0===e?1:e,a=t[1],i=void 0===a?1:a,o=t[2];return u(r,[n,0,0,0,0,i,0,0,0,0,void 0===o?1:o,0,0,0,0,1],4)}function j(r,t){var e=t[0],n=void 0===e?0:e,a=t[1],i=void 0===a?0:a,o=t[2];return u(r,[1,0,0,0,0,1,0,0,0,0,1,0,n,i,void 0===o?0:o,1],4)}function X(r,t){return u(r,t,4)}function p(r){for(var t=r*r,e=[],n=0;n<t;++n)e[n]=n%(r+1)?0:1;return e}function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(r){return e(n(r))}function e(r){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return r.forEach(function(r){var t=r.matrixFunction,e=r.functionValue;t&&(n=t(n,e))}),n}function n(r){return(function(r){return Array.isArray(r)}(r)?r:function(r){return t(r,"")}(r)).map(function(r){var t=function(r){var t=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(r);return!t||t.length<4?{}:{prefix:t[1],value:t[2],suffix:t[3]}}(r),e=t.prefix,n=t.value,a=null,i="";if("translate"===e||"translateX"===e||"translate3d"===e){var o=F(n).map(function(r){return parseFloat(r)}),u=o[0],f=o[1],s=void 0===f?0:f,l=o[2];a=j,i=[u,s,void 0===l?0:l]}else if("translateY"===e){a=j,i=[0,s=parseFloat(n),0]}else if("translateZ"===e){a=j,i=[0,0,parseFloat(n)]}else if("scale"===e||"scale3d"===e){var c=F(n).map(function(r){return parseFloat(r)}),v=c[0],d=c[1],p=void 0===d?v:d,h=c[2];a=S,i=[v,p,void 0===h?1:h]}else if("scaleX"===e){a=S,i=[v=parseFloat(n),1,1]}else if("scaleY"===e){a=S,i=[1,p=parseFloat(n),1]}else if("scaleZ"===e){a=S,i=[1,1,parseFloat(n)]}else if("rotate"===e||"rotateZ"===e||"rotateX"===e||"rotateY"===e){var m=function(r){var t=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(r);if(!t)return{prefix:"",unit:"",value:NaN};var e=t[1],n=t[2];return{prefix:e,unit:t[3],value:parseFloat(n)}}(n),x=m.unit,M=m.value;"rotate"===e||"rotateZ"===e?a=b:"rotateX"===e?a=y:"rotateY"===e&&(a=E),i="rad"===x?M:M*Math.PI/180}else if("matrix3d"===e)a=X,i=F(n).map(function(r){return parseFloat(r)});else if("matrix"===e){var g=F(n).map(function(r){return parseFloat(r)});a=X,i=[g[0],g[1],0,0,g[2],g[3],0,0,0,0,1,0,g[4],g[5],0,1]}return{name:e,value:n,matrixFunction:a,functionValue:i}})}return{parse:n,parseMat:a,toMat:e,getDistElementMatrix:function(r,t){void 0===t&&(t=document.body);for(var e=r,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e;){if(n=X(a(getComputedStyle(e).transform),n),e===t)break;e=e.parentElement}return(n=function(r,t){void 0===t&&(t=Math.sqrt(r.length));for(var e=r.slice(),n=p(t),a=0;a<t;++a){var i=t*a+a;if(0===e[i])for(var o=a+1;o<t;++o)if(e[t*a+o]){v(e,n,a,o,t);break}if(!e[i])return[];d(e,n,a,t,e[i]);for(o=0;o<t;++o){var u=o,f=e[o+a*t];0!==f&&a!==o&&s(e,n,u,a,t,-f)}}return n}(n,4))[12]=0,n[13]=0,n[14]=0,n},caculateMatrixDist:function(r,t){var e=function(r,t,e){void 0===e&&(e=t.length);var n=u(r,t,e),a=n[e-1];return n.map(function(r){return r/a})}(r,[t[0],t[1]||0,t[2]||0,1],4),n=e[3]||1;return[e[0]/n,e[1]/n,e[2]/n]},getElementMatrix:function(r){return a(getComputedStyle(r).transform)},createMatrix:r}});
//# sourceMappingURL=css-to-mat.min.js.map

/*
Copyright (c) 2019 Daybrush
name: css-to-mat
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/css-to-mat.git
version: 1.0.3
*/
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).CssToMatrix=r()}(this,function(){"use strict";var l=['"',"'",'\\"',"\\'"];function c(t,r,e,n){for(var a=e;a<n;++a){var i=r[a].trim();if(i===t)return a;var o=a;if("("===i?o=c(")",r,a+1,n):-1<l.indexOf(i)&&(o=c(i,r,a+1,n)),-1===o)break;a=o}return-1}function r(t,r){for(var e=new RegExp("(\\s*"+(r||",")+"\\s*|\\(|\\)|\"|'|\\\\\"|\\\\'|\\s+)","g"),n=t.split(e).filter(Boolean),a=n.length,i=[],o=[],u=0;u<a;++u){var f=n[u].trim(),s=u;if("("===f)s=c(")",n,u+1,a);else{if(")"===f)throw new Error("invalid format");if(-1<l.indexOf(f))s=c(f,n,u+1,a);else if(f===r){o.length&&(i.push(o.join("")),o=[]);continue}}-1===s&&(s=a-1),o.push(n.slice(u,s+1).join("")),u=s}return o.length&&i.push(o.join("")),i}function y(t){return r(t,",")}function s(t,r,e,n,a,i){for(var o=0;o<a;++o){var u=e+o*a,f=n+o*a;t[u]+=t[f]*i,r[u]+=r[f]*i}}function v(t,r,e,n,a){for(var i=0;i<a;++i){var o=e+i*a,u=n+i*a,f=t[o],s=r[o];t[o]=t[u],t[u]=f,r[o]=r[u],r[u]=s}}function d(t,r,e,n,a){for(var i=0;i<n;++i){var o=e+i*n;t[o]/=a,r[o]/=a}}function u(t,r,e){void 0===e&&(e=Math.sqrt(t.length));var n=[],a=t.length/e,i=r.length/a;if(!a)return r;if(!i)return t;for(var o=0;o<e;++o)for(var u=0;u<i;++u)for(var f=n[u*e+o]=0;f<a;++f)n[u*e+o]+=t[f*e+o]*r[u*a+f];return n}function E(t,r){return u(t,[1,0,0,0,0,Math.cos(r),Math.sin(r),0,0,-Math.sin(r),Math.cos(r),0,0,0,0,1],4)}function b(t,r){return u(t,[Math.cos(r),0,-Math.sin(r),0,0,1,0,0,Math.sin(r),0,Math.cos(r),0,0,0,0,1],4)}function S(t,r){return u(t,function(t,r){var e=Math.cos(t),n=Math.sin(t),a=p(r);return a[0]=e,a[1]=n,a[r]=-n,a[r+1]=e,a}(r,4))}function Z(t,r){var e=r[0],n=void 0===e?1:e,a=r[1],i=void 0===a?1:a,o=r[2];return u(t,[n,0,0,0,0,i,0,0,0,0,void 0===o?1:o,0,0,0,0,1],4)}function j(t,r){var e=r[0],n=void 0===e?0:e,a=r[1],i=void 0===a?0:a,o=r[2];return u(t,[1,0,0,0,0,1,0,0,0,0,1,0,n,i,void 0===o?0:o,1],4)}function X(t,r){return u(t,r,4)}function p(t){for(var r=t*t,e=[],n=0;n<r;++n)e[n]=n%(t+1)?0:1;return e}function t(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(t){return e(n(t))}function e(t){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t.forEach(function(t){var r=t.matrixFunction,e=t.functionValue;r&&(n=r(n,e))}),n}function n(t){return(function(t){return Array.isArray(t)}(t)?t:function(t){return r(t,"")}(t)).map(function(t){var r=function(t){var r=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);return!r||r.length<4?{}:{prefix:r[1],value:r[2],suffix:r[3]}}(t),e=r.prefix,n=r.value,a=null,i=e,o="";if("translate"===e||"translateX"===e||"translate3d"===e){var u=y(n).map(function(t){return parseFloat(t)}),f=u[0],s=u[1],l=void 0===s?0:s,c=u[2];a=j,o=[f,l,void 0===c?0:c]}else if("translateY"===e){a=j,o=[0,l=parseFloat(n),0]}else if("translateZ"===e){a=j,o=[0,0,parseFloat(n)]}else if("scale"===e||"scale3d"===e){var v=y(n).map(function(t){return parseFloat(t)}),d=v[0],p=v[1],h=void 0===p?d:p,m=v[2];a=Z,o=[d,h,void 0===m?1:m]}else if("scaleX"===e){a=Z,o=[d=parseFloat(n),1,1]}else if("scaleY"===e){a=Z,o=[1,h=parseFloat(n),1]}else if("scaleZ"===e){a=Z,o=[1,1,parseFloat(n)]}else if("rotate"===e||"rotateZ"===e||"rotateX"===e||"rotateY"===e){var x=function(t){var r=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!r)return{prefix:"",unit:"",value:NaN};var e=r[1],n=r[2];return{prefix:e,unit:r[3],value:parseFloat(n)}}(n),M=x.unit,g=x.value;"rotate"===e||"rotateZ"===e?(i="rotateZ",a=S):"rotateX"===e?a=E:"rotateY"===e&&(a=b),o="rad"===M?g:g*Math.PI/180}else if("matrix3d"===e)a=X,o=y(n).map(function(t){return parseFloat(t)});else if("matrix"===e){var F=y(n).map(function(t){return parseFloat(t)});a=X,o=[F[0],F[1],0,0,F[2],F[3],0,0,0,0,1,0,F[4],F[5],0,1]}else i="";return{name:e,functionName:i,value:n,matrixFunction:a,functionValue:o}})}return{parse:n,parseMat:a,toMat:e,getDistElementMatrix:function(t,r){void 0===r&&(r=document.body);for(var e=t,n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e;){if(n=X(a(getComputedStyle(e).transform),n),e===r)break;e=e.parentElement}return(n=function(t,r){void 0===r&&(r=Math.sqrt(t.length));for(var e=t.slice(),n=p(r),a=0;a<r;++a){var i=r*a+a;if(0===e[i])for(var o=a+1;o<r;++o)if(e[r*a+o]){v(e,n,a,o,r);break}if(!e[i])return[];d(e,n,a,r,e[i]);for(o=0;o<r;++o){var u=o,f=e[o+a*r];0!==f&&a!==o&&s(e,n,u,a,r,-f)}}return n}(n,4))[12]=0,n[13]=0,n[14]=0,n},calculateMatrixDist:function(t,r){var e=function(t,r,e){void 0===e&&(e=r.length);var n=u(t,r,e),a=n[e-1];return n.map(function(t){return t/a})}(t,[r[0],r[1]||0,r[2]||0,1],4),n=e[3]||1;return[e[0]/n,e[1]/n,e[2]/n]},getElementMatrix:function(t){return a(getComputedStyle(t).transform)},createMatrix:t}});
//# sourceMappingURL=css-to-mat.min.js.map

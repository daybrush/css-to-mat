{"version":3,"file":"css-to-mat.js","sources":["../src/CSSToMatrix.ts"],"sourcesContent":["import { mat4 } from \"gl-matrix\";\nimport { splitComma, splitBracket, splitUnit, splitSpace, isArray } from \"@daybrush/utils\";\nimport { MatrixInfo } from \"./types\";\n\nexport function parseMat(transform: string | string[]): number[] {\n    return toMat(parse(transform));\n}\nexport function toMat(matrixInfos: MatrixInfo[]): number[] {\n    const target = [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n\n    matrixInfos.forEach(info => {\n        const {\n            functionName,\n            functionValue,\n        } = info;\n\n        if (!functionName) {\n            return;\n        }\n        (mat4 as any)[functionName](target, target, functionValue);\n    });\n    return target;\n}\nexport function parse(transform: string | string[]): MatrixInfo[] {\n    const transforms = isArray(transform) ? transform : splitSpace(transform);\n\n    return transforms.map(t => {\n        const { prefix: name, value } = splitBracket(t);\n\n        let functionName: keyof typeof mat4 | \"\" = \"\";\n        let functionValue: any = \"\";\n\n        if (name === \"translate\" || name === \"translateX\" || name === \"translate3d\") {\n            const [posX, posY = 0, posZ = 0] = splitComma(value!).map(v => parseFloat(v));\n\n            functionName = \"translate\";\n            functionValue = [posX, posY, posZ];\n        } else if (name === \"translateY\") {\n            const posY = parseFloat(value!);\n\n            functionName = \"translate\";\n            functionValue = [0, posY, 0];\n        } else if (name === \"translateZ\") {\n            const posZ = parseFloat(value!);\n\n            functionName = \"translate\";\n            functionValue = [0, 0, posZ];\n        } else if (name === \"scale\" || name === \"scale3d\") {\n            const [sx, sy = sx, sz = 1] = splitComma(value!).map(v => parseFloat(v)) as number[];\n\n            functionName = \"scale\";\n            functionValue = [sx, sy, sz];\n        } else if (name === \"scaleX\") {\n            const sx = parseFloat(value!);\n\n            functionName = \"scale\";\n            functionValue = [sx, 1, 1];\n        } else if (name === \"scaleY\") {\n            const sy = parseFloat(value!);\n\n            functionName = \"scale\";\n            functionValue = [1, sy, 1];\n        } else if (name === \"scaleZ\") {\n            const sz = parseFloat(value!);\n            functionName = \"scale\";\n            functionValue = [1, 1, sz];\n        } else if (name === \"rotate\" || name === \"rotateZ\" || name === \"rotateX\" || name === \"rotateY\") {\n            const { unit, value: unitValue } = splitUnit(value!);\n            const rad = unit === \"rad\" ? unitValue : unitValue * Math.PI / 180;\n\n            functionName = name === \"rotate\" ? \"rotateZ\" : name;\n            functionValue = rad;\n        } else if (name === \"matrix3d\") {\n            functionName = \"multiply\";\n            functionValue = splitComma(value!).map(v => parseFloat(v));\n        } else if (name === \"matrix\") {\n            const m = splitComma(value!).map(v => parseFloat(v));\n            functionName = \"multiply\";\n            functionValue = [\n                m[0], m[1], 0, 0,\n                m[2], m[3], 0, 0,\n                0, 0, 1, 0,\n                m[4], m[5], 0, 1,\n            ];\n        }\n        return {\n            name: name!,\n            value: value!,\n            functionName,\n            functionValue,\n        };\n    });\n}\n"],"names":["parseMat","transform","toMat","parse","matrixInfos","target","forEach","info","functionName","functionValue","mat4","transforms","isArray","splitSpace","map","t","_a","name","value","_b","posX","_c","posY","_d","posZ","parseFloat","_e","sx","_f","sy","_g","sz","_h","unit","unitValue","rad","Math","PI","splitComma","v","m"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}